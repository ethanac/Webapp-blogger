{% extends '__base__.html' %}

{% block title %}Comments{% endblock %}

{% block beforehead %}

<script>
    function initVM(data) {
        $('#vm').show();
        var vm = new Vue({
            el: '#vm',
            data: {
                comments: data.comments,
                page: data.page
            },
            methods: {
                delete_comment: function (comment) {
                    var content = comment.content.length > 20 ? comment.content.substring(0, 20) + '...' : comment.content;
                    if (confirm('Confirm to delete the comment:"' + comment.content + '"? Deletion cannot recover?')) {
                        postJSON('/api/comments/' + comment.id + '/delete', function (err, r) {
                            if (err) {
                                return error(err);
                            }
                            refresh();
                        });
                    }
                }
            }
        });
    }

    $(function () {
        getJSON('/api/comments', {
            page: {{ page_index }}
        }, function (err, results) {
            if (err) {
                return fatal(err);
            }
            $('#loading').hide();
            initVM(results);
        });
    });
</script>

{% endblock %}